<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WIN Contrato Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <style>
      /* Estilos generales e inspiración Apple */
      body {
        margin: 0; /* Quitar márgenes por defecto */
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background-color: #f9fafb;
      }
      .contract-section {
        margin: 1rem 0;
      }
      .bold-keyword {
        font-weight: 600;
        color: #1e40af;
      }
      /* Animación fade-in para el contrato */
      .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      /* ===============================
         SIDEBAR IZQUIERDO (OPCIONES DE CONTRATO)
         =============================== */
      .sidebar {
        width: 60px;
        height: 100vh;
        background-color: #5b5f63;
        padding: 20px;
        box-sizing: border-box;
        color: #fff;
        overflow: hidden;
        border-radius: 0 5px 5px 0;
        transition: width 0.15s ease;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 50;
      }
      .sidebar:hover {
        width: 540px;
      }
      /* Texto vertical cuando el sidebar está contraído */
      .sidebar-collapsed-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(-90deg);
        transform-origin: center;
        font-weight: bold;
        white-space: nowrap;
      }
      .sidebar:hover .sidebar-collapsed-text {
        display: none;
      }
      .sidebar-content {
        opacity: 0;
        transition: opacity 0.5s ease;
        pointer-events: none;
      }
      .sidebar:hover .sidebar-content {
        opacity: 1;
        pointer-events: auto;
      }
      .sidebar input,
      .sidebar select {
        background-color: #fff;
        color: #000;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 4px 8px;
        margin-top: 4px;
      }
      .sidebar label {
        display: block;
        margin-top: 8px;
        color: #fff;
      }
      /* ===============================
         SIDEBAR DERECHO (PLANES FRECUENTES)
         =============================== */
      .right-sidebar {
        position: fixed;
        top: 0;
        right: 0;
        width: 60px;
        height: 100vh;
        background-color: #5b5f63;
        padding: 20px;
        box-sizing: border-box;
        color: #fff;
        overflow: hidden;
        border-radius: 5px 0 0 5px;
        transition: width 0.15s ease;
        z-index: 50;
      }
      .right-sidebar:hover {
        width: 540px;
      }
      .right-sidebar-collapsed-text {
        position: absolute;
        top: 50%;
        right: 50%;
        transform: translate(50%, -50%) rotate(90deg);
        transform-origin: center;
        font-weight: bold;
        white-space: nowrap;
      }
      .right-sidebar:hover .right-sidebar-collapsed-text {
        display: none;
      }
      .right-sidebar-content {
        opacity: 0;
        transition: opacity 0.5s ease;
        pointer-events: none;
      }
      .right-sidebar:hover .right-sidebar-content {
        opacity: 1;
        pointer-events: auto;
      }
      /* ===============================
         PANEL DEL CONTRATO
         =============================== */
      .contract-panel {
        margin-left: 60px; /* Igual al ancho contraído del sidebar izquierdo */
        margin-right: 60px; /* Espacio para el sidebar derecho */
        padding: 20px;
        transition: margin 0.75s ease;
      }
    </style>
  </head>
  <body>
    <!-- SIDEBAR IZQUIERDO: OPCIONES DE CONTRATO -->
    <div class="sidebar">
      <!-- Texto vertical cuando está contraído -->
      <div class="sidebar-collapsed-text">OPCIONES DE CONTRATO</div>
      <div class="sidebar-content">
        <h1 class="text-lg font-semibold mb-4">Opciones de Contratación</h1>
        <form id="contractForm" class="space-y-3 text-sm">
          <!-- Ubicación -->
          <div>
            <label for="location">Ubicación</label>
            <select id="location" class="w-full">
              <option value="lima" selected>Lima</option>
              <option value="provincia">Provincia</option>
            </select>
          </div>
          <!-- Tipo de Documento -->
          <div>
            <label for="documentType">Tipo de Documento</label>
            <select id="documentType" class="w-full">
              <option value="dni" selected>DNI/CE/RUC 10</option>
              <option value="ruc">RUC 20</option>
            </select>
          </div>
          <!-- Plan de Instalación (solo para RUC 20) -->
          <div id="installmentSection" class="hidden">
            <label for="installmentOption">Pago de Instalación</label>
            <select id="installmentOption" class="w-full">
              <option value="1">1 cuota – S/ 60</option>
              <option value="3">3 cuotas – S/ 120</option>
            </select>
          </div>
          <!-- Tipo de Servicio -->
          <div>
            <label>Tipo de Servicio</label>
            <div class="flex gap-2">
              <label class="inline-flex items-center">
                <input type="checkbox" name="serviceType" value="fibra" class="form-checkbox h-4 w-4" checked />
                <span class="ml-1">Fibra</span>
              </label>
              <label class="inline-flex items-center">
                <input type="checkbox" name="serviceType" value="sva" class="form-checkbox h-4 w-4" />
                <span class="ml-1">SVA</span>
              </label>
            </div>
          </div>
          <!-- Velocidad de Fibra (visible solo si se selecciona Fibra) -->
          <div id="fiberSpeedSection" class="hidden">
            <label for="fiberSpeed">Velocidad de Fibra (Mbps)</label>
            <select id="fiberSpeed" class="w-full"></select>
          </div>
          <!-- Servicios de Valor Agregado (SVA) -->
          <div id="svaSection" class="hidden">
            <label>Servicios de Valor Agregado (SVA)</label>
            <div id="svaOptions" class="grid grid-cols-2 gap-2 mt-1">
              <label class="inline-flex items-center p-2 border border-gray-200 rounded-md hover:shadow-md transition">
                <input type="checkbox" name="svaOption" value="fono" class="form-checkbox h-4 w-4" />
                <span class="ml-1">Fono</span>
              </label>
			  <label class="inline-flex items-center p-2 border border-gray-200 rounded-md hover:shadow-md transition">
                <input type="checkbox" name="svaOption" value="Mesh_inalambrico" class="form-checkbox h-4 w-4" />
                <span class="ml-1">Mesh 400/600</span>
              </label>
              <label class="inline-flex items-center p-2 border border-gray-200 rounded-md hover:shadow-md transition">
                <input type="checkbox" name="svaOption" value="Mesh" class="form-checkbox h-4 w-4" />
                <span class="ml-1">Mesh (comodato)</span>
              </label>
              <label class="inline-flex items-center p-2 border border-gray-200 rounded-md hover:shadow-md transition">
                <input type="checkbox" name="svaOption" value="Winbox" class="form-checkbox h-4 w-4" />
                <span class="ml-1">Winbox (comodato)</span>
              </label>
              <label class="inline-flex items-center p-2 border border-gray-200 rounded-md hover:shadow-md transition">
                <input type="checkbox" name="svaOption" value="wintv_basico" class="form-checkbox h-4 w-4" />
                <span class="ml-1">Wintv Básico</span>
              </label>
              <label class="inline-flex items-center p-2 border border-gray-200 rounded-md hover:shadow-md transition">
                <input type="checkbox" name="svaOption" value="wintv_plus" class="form-checkbox h-4 w-4" />
                <span class="ml-1">Wintv Plus</span>
              </label>
              <label class="inline-flex items-center p-2 border border-gray-200 rounded-md hover:shadow-md transition">
                <input type="checkbox" name="svaOption" value="wintv_premium" class="form-checkbox h-4 w-4" />
                <span class="ml-1">Wintv Premium</span>
              </label>
              <!-- Se agrega opción para Wintv L1 Max (no premium) -->
              <label class="inline-flex items-center p-2 border border-gray-200 rounded-md hover:shadow-md transition">
                <input type="checkbox" name="svaOption" value="wintvL1Max" class="form-checkbox h-4 w-4" />
                <span class="ml-1">Wintv L1 Max</span>
              </label>
              <!-- Se agrega opción para Win Games -->
              <label class="inline-flex items-center p-2 border border-gray-200 rounded-md hover:shadow-md transition">
                <input type="checkbox" name="svaOption" value="winGames" class="form-checkbox h-4 w-4" />
                <span class="ml-1">Win Games</span>
              </label>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- SIDEBAR DERECHO: PLANES FRECUENTES -->
    <div class="right-sidebar">
      <!-- Texto vertical cuando está contraído -->
      <div class="right-sidebar-collapsed-text">PLANES FRECUENTES</div>
      <div class="right-sidebar-content">
        <h1 class="text-lg font-semibold mb-4">Ofertas más frecuentes</h1>
        <div id="offerButtons" class="space-y-3 mt-4">
          <button type="button" data-fiber="400" data-sva='["Mesh_inalambrico"]' class="offer-button w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600 transition">
            Plan de 400 + Mesh inalambrico
          </button>
          <button type="button" data-fiber="350" data-sva='["wintvL1Max","Winbox"]' class="offer-button w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600 transition">
            Plan de 350 + Wintv L1 Max + Winbox en comodato
          </button>
          <button type="button" data-fiber="550" data-sva='["wintv_l1max_premium","Mesh","Winbox"]' class="offer-button w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600 transition">
            Plan de 550 Wintv L1 Max Premium + Mesh comodato + Winbox comodato
          </button>
          <button type="button" data-fiber="750" data-sva='["wintv_l1max_premium","Mesh","Winbox","winGames"]' class="offer-button w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600 transition">
            Plan de 750 Wintv L1 Max Premium + Mesh comodato + Winbox comodato + Win Game
          </button>
        </div>
      </div>
    </div>

    <!-- PANEL DEL CONTRATO -->
    <div class="contract-panel">
      <div id="contractOutput" class="bg-white p-6 rounded-lg shadow-sm transition-all duration-500 ease-in-out fade-in">
        <h2 class="text-2xl font-bold text-center mb-4">CONTRATO DE WIN</h2>
        <!-- Bloque de resumen del plan -->
        <div id="planSummary" class="text-center text-lg font-mono font-bold text-white bg-blue-500 p-2 rounded mb-4"></div>
        <div id="contractContent" class="prose text-sm"></div>
      </div>
    </div>

    <script>
      /***************************************
       * CONSTANTES DE SVA
       ***************************************/
      const svaInfo = {
        fono: {
          label: "Fono",
          description: ""
        },
		Mesh_inalambrico: {
          label: "MESH",
    description: `<br> <br> De manera adicional e independiente al servicio de internet fijo, mientras mantengas vigente el servicio, accedes a:<br> <br> Un (01) equipo no terminal / Dos (2) equipos no terminales Mesh en comodato.<br> <br> La instalación alámbrica tiene un costo adicional de S/ 55.00 incluido IGV por equipo. ¿Deseas la instalación alámbrica? (CLIENTE RESPONDE)<br> <br> La entrega se realizará en el domicilio del servicio de internet, el titular deberá exhibir el DNI/CE en físico, para validar su identidad, y suscribir el Acta de Entrega.<br> <br> Para mayor información de términos y condiciones ingresa a win.pe <br> <br> ¿Aceptas los términos del presente acuerdo? (CLIENTE RESPONDE).<br> <br> `
		},
        Mesh: {
          label: "Mesh (comodato)",
          description: "Equipo MESH en comodato."
        },
        Winbox: {
          label: "Winbox (comodato)",
          description: "Equipo Winbox en comodato."
        },
        wintv_basico: {
          label: "Wintv básico",
          description: "Servicio básico de Wintv."
        },
        wintv_plus: {
          label: "Wintv Plus",
          description: "Servicio Wintv Plus."
        },
        wintv_premium: {
          label: "Wintv Premium",
          description: "Servicio Wintv Premium."
        },
        // Para opción sin el sufijo premium
        wintvL1Max: {
          label: "WINTV L1 MAX",
          description: ""
        },
        wintv_l1max_premium: {
          label: "WINTV L1 MAX PREMIUM",
          description: ""
        },
        winGames: {
          label: "Win Games",
          description: "Acceso a Win Games."
        }
      };

      // Variable global para el valor del Ubigeo
      let currentUbigeoValue = "";

      // Función que retorna la velocidad real para el contrato (350, 600, 1000, etc.)
      function getDisplaySpeed(speed) {
        if (speed === 360) return 350;
        if (speed === 610) return 600;
        if (speed === 1010) return 1000;
        return speed;
      }

      // Función que retorna el texto para el select de velocidades
      function getSelectSpeedText(speed) {
        if (speed === 360) return "350 Gamer";
        if (speed === 610) return "600 Gamer";
        if (speed === 1010) return "1000 Gamer";
        return speed + " Mbps";
      }
      
      // Actualiza el contrato y resumen al cargar o cambiar opciones
      document.addEventListener('DOMContentLoaded', function () {
        updateFiberSpeeds();
        updateFormSections();
        updateInstallmentSection();
        updateContract();
        
        // Escucha cambios en todos los selects e inputs del formulario
        const formElements = document.querySelectorAll('#contractForm select, #contractForm input');
        formElements.forEach(el => {
          el.addEventListener('change', function () {
            // Si se desmarca la casilla SVA, se limpian las opciones internas
            if (el.name === "serviceType" && el.value === "sva" && !el.checked) {
              document.querySelectorAll('#svaOptions input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
              });
            }
            // Si se cambia la velocidad de fibra, limpiar los SVA
            if (el.id === 'fiberSpeed') {
              document.querySelectorAll('#svaOptions input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
              });
            }
            if (el.id === 'location') updateFiberSpeeds();
            if (el.id === 'documentType') {
              updateInstallmentSection();
            }
            updateFormSections();
            updateContract();
          });
        });
        
        // Agregar eventos a los botones de ofertas del sidebar derecho
        document.querySelectorAll('.offer-button').forEach(button => {
          button.addEventListener('click', function() {
            const fiber = button.getAttribute('data-fiber');
            const svaData = JSON.parse(button.getAttribute('data-sva'));
            const offer = {
              fiberSpeed: fiber,
              sva: svaData
            };
            applyOffer(offer);
          });
        });
      });
      
      // Muestra/oculta secciones según selección
      function updateFormSections() {
        const isFibra = document.querySelector('input[name="serviceType"][value="fibra"]').checked;
        const isSVA = document.querySelector('input[name="serviceType"][value="sva"]').checked;
        document.getElementById('fiberSpeedSection').classList.toggle('hidden', !isFibra);
        document.getElementById('svaSection').classList.toggle('hidden', !isSVA);
      }
      
      // Muestra/oculta plan de instalación para RUC 20
      function updateInstallmentSection() {
        const documentTypeSelect = document.getElementById('documentType');
        const installmentSection = document.getElementById('installmentSection');
        if (documentTypeSelect.value === 'ruc') {
          installmentSection.classList.remove('hidden');
        } else {
          installmentSection.classList.add('hidden');
        }
      }
      
      // Actualiza el select de velocidades según la ubicación
      function updateFiberSpeeds() {
        const locationSelect = document.getElementById('location');
        const fiberSpeedSelect = document.getElementById('fiberSpeed');
        const selectedLocation = locationSelect.value;
        let speeds = [];
        if (selectedLocation === 'lima') {
          speeds = [200, 300, 350, 360, 400, 550, 600, 610, 750, 850, 1000, 1010];
        } else {
          speeds = [350, 360, 550, 610, 850, 1000, 1010];
        }
        fiberSpeedSelect.innerHTML = speeds
          .map(speed => `<option value="${speed}">${getSelectSpeedText(speed)}</option>`)
          .join('');
      }
      
      // Genera el texto del contrato y actualiza el resumen del plan
      function updateContract() {
        const currentDate = moment();
        const location = document.getElementById('location').value;
        const fiberSpeed = parseInt(document.getElementById('fiberSpeed').value);
        const documentType = document.getElementById('documentType').value;
        const installmentOption = document.getElementById('installmentOption') ? document.getElementById('installmentOption').value : null;
        const selectedServices = Array.from(document.querySelectorAll('input[name="serviceType"]:checked')).map(el => el.value);
        
        // Para SVA, solo si la casilla principal está marcada
        const svaCheckboxChecked = document.querySelector('input[name="serviceType"][value="sva"]').checked;
        let selectedSVA = [];
        if (svaCheckboxChecked) {
          selectedSVA = Array.from(document.querySelectorAll('#svaOptions input:checked')).map(el => el.value);
        }
        
        // Separamos la opción "fono" de los demás SVA
        const additionalSVA = selectedSVA.filter(sva => sva !== "fono");
        
        const plan = config.pricing[location][fiberSpeed];
        
        // Actualiza el resumen del plan
        let planSummaryText = "";
        if (selectedServices.includes("fibra")) {
          const docLabel = documentType === "ruc" ? "RUC 20" : "DNI/CE/RUC 10";
          planSummaryText = `${location.toUpperCase()} - ${docLabel} PLAN: ${getDisplaySpeed(fiberSpeed)} Mbps`;
          if (documentType === "ruc") {
            let installmentText = "";
            if (installmentOption === "1") {
              installmentText = "pago inst. 1 cuota";
            } else if (installmentOption === "3") {
              installmentText = "pago inst. 3 cuotas";
            }
            if (installmentText) {
              planSummaryText += " + " + installmentText;
            }
          }
          // Orden para mostrar los SVA en el resumen
          const svaOrder = ["fono", "Mesh", "Winbox", "wintv_basico", "wintv_plus", "wintv_premium", "wintvL1Max", "wintv_l1max_premium", "winGames", "Mesh_inalambrico"];
          let selectedSvaForSummary = svaOrder.filter(sva => selectedSVA.includes(sva));
          if (selectedSvaForSummary.length > 0) {
            planSummaryText += " + " + selectedSvaForSummary.map(sva => svaInfo[sva].label).join(" + ");
          }
        }
        document.getElementById("planSummary").innerHTML = planSummaryText;
        
        let datosText = "";
        if (documentType === "ruc") {
          datosText = `<p>
            Nombre de la empresa (Razón social)<br>
            Datos del representante legal (Nombre completo, DNI)<br>
            Número de RUC (20…)<br>
            Correo electrónico para el envío de recibos<br>
            Su número de contacto<br>
            Dirección en la que se instalará el servicio
          </p>`;
        } else {
          let ubigeoDisplayText = "";
          if (currentUbigeoValue && ubigeoData[currentUbigeoValue]) {
            const data = ubigeoData[currentUbigeoValue];
            ubigeoDisplayText = `Distrito: ${data.distrito}, Provincia: ${data.provincia}, Departamento: ${data.departamento}`;
          }
          datosText = `<p>
            Su nombre completo es<br>
            Su número de Documento de Identidad / CE / RUC (10…)<br>
            <div style="display: flex; align-items: center; margin: 4px 0;">
              <span style="margin-right: 8px;">Lugar y Fecha de Nacimiento</span>
              <input type="text" id="ubigeoInput" placeholder="Ubigeo" style="width: 120px; padding: 4px; border: 1px solid #ccc; border-radius: 4px;" value="${currentUbigeoValue}">
              <span id="ubigeoDisplay" style="margin-left: 4px; font-size: 0.875rem; color: #4a5568;">${ubigeoDisplayText}</span>
            </div>
            Correo electrónico para el envío de recibos<br>
            Su número telefónico es<br>
            Dirección en la que se instalará el servicio
          </p>`;
        }
        
        let pricingText = '';
        if (documentType === 'ruc') {
          pricingText = `El precio mensual es de <strong class="bold-keyword">S/ ${plan.pb}</strong> incluye I.G.V.`;
        } else {
          if (!plan.vbp && !plan.pp) {
            pricingText = `El precio mensual es de <strong class="bold-keyword">S/ ${plan.pb}</strong> incluye I.G.V.`;
          } else if (plan.vbp && !plan.pp) {
            pricingText = `El precio mensual es de <strong class="bold-keyword">S/ ${plan.pb}</strong> incluye I.G.V. Por promoción, los primeros <strong class="bold-keyword">06 meses</strong>, incrementamos tu velocidad a <strong class="bold-keyword">${plan.vbp} Mbps</strong>, con un mínimo garantizado de <strong class="bold-keyword">${plan.vmp} Mbps</strong> de carga y descarga; vencidos estos plazos, se aplicarán las condiciones regulares.`;
          } else if (plan.vbp && plan.pp) {
            pricingText = `El precio mensual es de <strong class="bold-keyword">S/ ${plan.pb}</strong> incluye I.G.V. Por promoción, los primeros <strong class="bold-keyword">06 meses</strong>, incrementamos tu velocidad a <strong class="bold-keyword">${plan.vbp} Mbps</strong>, con un mínimo garantizado de <strong class="bold-keyword">${plan.vmp} Mbps</strong> de carga y descarga, pagarás a un precio promocional de <strong class="bold-keyword">S/ ${plan.pp}</strong> incluye I.G.V (por los primeros <strong class="bold-keyword">03 meses</strong>); vencidos estos plazos, se aplicarán las condiciones regulares.`;
          } else if (!plan.vbp && plan.pp) {
            pricingText = `El precio mensual es de <strong class="bold-keyword">S/ ${plan.pb}</strong> incluye I.G.V. Por promoción, los primeros <strong class="bold-keyword">03 meses</strong>, pagarás a un precio promocional de <strong class="bold-keyword">S/ ${plan.pp}</strong> (incluye I.G.V.); vencidos estos plazos, se aplicarán las condiciones regulares.`;
          }
        }
        
        let installationText = '';
        if (documentType === 'ruc') {
          if (installmentOption === '1') {
            installationText = `<p>El precio de instalación es de <strong class="bold-keyword">S/ 120.00</strong> incluido IGV, con un precio promocional de <strong class="bold-keyword">S/ 60.00</strong>.</p>`;
          } else if (installmentOption === '3') {
            installationText = `<p>El precio de instalación es de <strong class="bold-keyword">S/ 120.00</strong> incluido IGV, el cual puedes fraccionar en tres (03) cuotas sin intereses.</p>`;
          }
        }
        
        // Estructuramos el contrato en secciones:
        let contractText = `
          <div class="space-y-3 fade-in">
            <p class="text-sm">Hoy ${currentDate.format('DD')} de ${currentDate.format('MMMM')} del ${currentDate.format('YYYY')}, en la ciudad de LIMA, usted contrata con WIN, para ello me brinda los siguientes datos:</p>
            ${datosText}
            
            <!-- Sección FIBRA (si está seleccionada) -->
            <div class="contract-section">
              ${ selectedServices.includes('fibra') ? `
              <h3 class="font-bold text-base">FIBRA</h3>
              <p>El servicio de internet fijo postpago de WIN es ilimitado, 100% fibra óptica, con velocidad simétrica de <strong class="bold-keyword">${getDisplaySpeed(fiberSpeed)} Mbps</strong> de carga y descarga, con un mínimo garantizado de <strong class="bold-keyword">${plan.vm} Mbps</strong> de carga y descarga, incluye un equipo terminal router y conector en comodato, el cual deberá devolver en buenas condiciones; caso contrario, pagarás su valor. El contrato tendrá plazo indeterminado y podrá ser resuelto de acuerdo a la normativa de condiciones de uso.</p>
              <br>
              <p>${pricingText}</p>
              ` : ''}
            </div>
            
            ${documentType === 'ruc' ? installationText : ''}
            
            <!-- Sección Reconexión con bloque FONO (si se selecciona) -->
            <div class="contract-section">
              <p>La tarifa de reconexión es de <strong class="bold-keyword">S/ 10.00</strong>, incluye I.G.V.</p>
              ${ selectedSVA.includes("fono") ? `
              <div class="mt-3">
                <h3 class="font-bold text-base">FIJO</h3>
                <p class="text-gray-900">El servicio de telefonía fija VoIP postpago se brinda a través de la red de internet de WIN. Incluye un equipo de telefonía analógico en comodato, llamadas ilimitadas dentro de la red de WIN y un paquete mensual de 100 minutos para llamar a todo operador a nivel nacional, no acumulable. El precio mensual del servicio es de <strong class="bold-keyword">S/ 10.00</strong>, incluye I.G.V.</p>
                <div class="mt-1 text-gray-500 text-xs">
                  <p>(En caso de portabilidad de otro operador)</p>
                  <p>Para fines de la portabilidad, se confirma lo siguiente:</p>
                  <ul class="list-disc ml-5">
                    <li>Concesionario Cedente (Empresa Operadora)</li>
                    <li>Número Telefónico Fijo a Portar</li>
                    <li>Modalidad de Pago con el Cedente (Postpago/Prepago)</li>
                  </ul>
                  <p>El trámite es gratuito, tiene un plazo de 24 horas desde la solicitud y se encuentra sujeto a condiciones técnicas de acuerdo al Artículo 5 del Reglamento de Portabilidad Numérica.</p>
                </div>
              </div>
              ` : ''}
            </div>
            
            <!-- Sección de Facturación y demás datos -->
            <div class="contract-section">
              <p>La fecha de facturación es el <strong class="bold-keyword">12</strong> de cada mes, y la fecha de vencimiento es el <strong class="bold-keyword">28</strong> del mismo mes.</p>
              <br>
              <p>Le agradeceré que diga fuerte y claramente que <strong class="bold-keyword">SÍ ACEPTA</strong> los términos de la presente contratación. <strong class="bold-keyword">CLIENTE RESPONDE SI</strong>.</p>
              <br>
              <p>WIN realizará el tratamiento de datos personales para gestiones relacionadas con el servicio, se almacenarán tus datos en nuestro Banco de Datos de clientes de acuerdo a la normativa vigente. Podrás ejercer tus derechos ARCO escribiendo al correo protecciondedatos@win.pe. Para más información visita win.pe/protección-de-datos.</p>
              <br>
              <p>¿Declaras conocer la Política de Privacidad y autorizas de forma previa, expresa, informada e inequívoca el tratamiento de datos personales? <strong class="bold-keyword">CLIENTE RESPONDE SI</strong>.</p>
              <br>
              <p>¿Aceptas el envío de comunicaciones comerciales, publicitarias y encuestas? <strong class="bold-keyword">CLIENTE RESPONDE SI/NO</strong>.</p>
            </div>
            
            <!-- Sección de Servicios Adicionales (para SVA distintos a fono) -->
            ${ additionalSVA.length > 0 ? `
            <div class="contract-section">
              <div class="mt-3 border-t pt-3">
                <h4 class="text-base font-semibold">Servicios Adicionales:</h4>
                ${ additionalSVA.map(sva => `<p class="mt-1">${getSVADescription(sva)}</p>`).join('') }
              </div>
            </div>
            ` : '' }
            
            <!-- Mensaje final -->
            <div class="contract-section">
              <p class="mt-3 text-center font-bold text-blue-600">BIENVENIDO A LA FAMILIA WIN.</p>
            </div>
          </div>
        `;
        
        document.getElementById('contractContent').innerHTML = contractText;
        
        // Actualiza el valor del Ubigeo
        const ubigeoInput = document.getElementById('ubigeoInput');
        if (ubigeoInput) {
          ubigeoInput.addEventListener('input', function(e) {
            currentUbigeoValue = e.target.value.trim();
            const ubigeoDisplay = document.getElementById('ubigeoDisplay');
            if (currentUbigeoValue && ubigeoData[currentUbigeoValue]) {
              const data = ubigeoData[currentUbigeoValue];
              ubigeoDisplay.textContent = `Distrito: ${data.distrito}, Provincia: ${data.provincia}, Departamento: ${data.departamento}`;
            } else {
              ubigeoDisplay.textContent = "";
            }
          });
        }
      }
      
      // Función que retorna la descripción de SVA usando la constante svaInfo
      function getSVADescription(sva) {
        return svaInfo[sva]
          ? `<strong class="bold-keyword">${svaInfo[sva].label}</strong>: ${svaInfo[sva].description}`
          : '';
      }
      
      /***************************************
       * CONFIGURACIÓN DE VALORES
       ***************************************/
      const config = {
        pricing: {
          lima: {
            200: { vb: 200, vm: 140, pb: 99,  vbp: 400, vmp: 280 },
            300: { vb: 300, vm: 210, pb: 119, vbp: 600, vmp: 420, pp: 89 },
            350: { vb: 350, vm: 245, pb: 129 },
            360: { vb: 350, vm: 245, pb: 129, pp: 99 },
            400: { vb: 400, vm: 280, pb: 129, vbp: 800, vmp: 560, pp: 99 },
            550: { vb: 550, vm: 385, pb: 139, pp: 109 },
            600: { vb: 600, vm: 420, pb: 139, pp: 109 },
            610: { vb: 600, vm: 420, pb: 159, pp: 129 },
            750: { vb: 750, vm: 525, pb: 149, pp: 119 },
            850: { vb: 850, vm: 595, pb: 99, pp: 69 },
            1000: { vb: 1000, vm: 700, pb: 159, pp: 129 },
            1010: { vb: 1000, vm: 700, pb: 189, pp: 159 }
          },
          provincia: {
            350:  { vb: 350, vm: 245, pb: 69,  vbp: 700, vmp: 490 },
            360: { vb: 350, vm: 245, pb: 129, pp: 99 },
            550:  { vb: 550, vm: 385, pb: 89,  vbp: 800, vmp: 700 },
            610: { vb: 600, vm: 420, pb: 159, pp: 129 },
            850: { vb: 850, vm: 595, pb: 99, pp: 69 },
            1000: { vb: 1000, vm: 700, pb: 109, pp: 79 },
            1010: { vb: 1000, vm: 700, pb: 189, pp: 159 }
          }
        },
        // La información de precios de SVA se ha integrado en la constante svaInfo
        svaPrices: {
          Mesh: 29.90,
          Winbox: 14.90,
          wintv_basico: 9.90,
          wintv_plus: 24.90,
          wintv_premium: 39.90
        }
      };
      
      // CSV de Ubigeo
      const ubigeoCSV = `Ubigeo,Distrito,Provincia,Departamento
010101,Chachapoyas,Chachapoyas,Amazonas
250401,Purus,Purus,Ucayali`;
      
      function parseUbigeoCSV(csv) {
        const lines = csv.split('\n').map(line => line.trim()).filter(line => line);
        const result = {};
        const header = lines[0].split(',');
        for (let i = 1; i < lines.length; i++) {
          const cols = lines[i].split(',');
          const code = cols[0];
          result[code] = {
            distrito: cols[1],
            provincia: cols[2],
            departamento: cols[3]
          };
        }
        return result;
      }
      
      const ubigeoData = parseUbigeoCSV(ubigeoCSV);
      
      // Función que aplica la oferta seleccionada desde el sidebar derecho
      function applyOffer(offer) {
        // Limpia los checkboxes de SVA en el sidebar izquierdo
        document.querySelectorAll('#svaOptions input[type="checkbox"]').forEach(cb => {
          cb.checked = false;
        });
        // Establece la velocidad de fibra según la oferta (si existe en el select)
        const fiberSpeedSelect = document.getElementById('fiberSpeed');
        if (fiberSpeedSelect) {
          fiberSpeedSelect.value = offer.fiberSpeed;
        }
        // Activa los SVA indicados en la oferta
        offer.sva.forEach(svaValue => {
          const checkbox = document.querySelector(`#svaOptions input[type="checkbox"][value="${svaValue}"]`);
          if (checkbox) {
            checkbox.checked = true;
          }
        });
        // Asegura que los checkboxes de tipo de servicio estén activados según corresponda
        const fibraCheckbox = document.querySelector('input[name="serviceType"][value="fibra"]');
        const svaCheckbox = document.querySelector('input[name="serviceType"][value="sva"]');
        if (fibraCheckbox) fibraCheckbox.checked = true;
        if (svaCheckbox) svaCheckbox.checked = offer.sva.length > 0;
        
        updateFormSections();
        updateContract();
      }
    </script>
  </body>
</html>
